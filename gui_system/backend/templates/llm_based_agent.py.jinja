"""
{{ agent.name }}
{{ agent.description or '' }}

Generated from AI-Agent-Builder GUI
"""

from agent_framework import Agent, Signal, LLMConfig, AgentConfig
from agent_framework.utils import parse_llm_signal, format_fundamentals
from typing import Dict, Any


class {{ class_name }}Agent(Agent):
    """{{ agent.goal }}"""
    
    def __init__(self):
        system_prompt = """{{ system_prompt }}"""
        
        config = AgentConfig(
            name="{{ agent.name }}",
            description="{{ agent.description or agent.goal }}",
            llm=LLMConfig(
                provider="{{ llm_config.provider }}",
                model="{{ llm_config.model }}",
                temperature={{ llm_config.temperature }},
                max_tokens={{ llm_config.max_tokens }},
                system_prompt=system_prompt
            )
        )
        super().__init__(config)
    
    def analyze(self, ticker: str, data: Dict[str, Any]) -> Signal:
        """Analyze stock data using LLM.
        
        Args:
            ticker: Stock ticker
            data: Market/fundamental data
            
        Returns:
            Trading signal
        """
        # Format data for LLM
        formatted_data = format_fundamentals(data)
        
        prompt = f"""Analyze {ticker}:
        
{formatted_data}

Provide your signal, confidence, and reasoning."""
        
        # Call LLM
        response = self.llm.generate(prompt)
        
        # Parse response using shared utility
        return parse_llm_signal(response, fallback_reasoning=f"Analysis for {ticker}")


# Usage example
if __name__ == "__main__":
    import asyncio
    from agent_framework import Database, Config
    
    async def main():
        db = Database(Config.get_database_url())
        await db.connect()
        
        agent = {{ class_name }}Agent()
        data = await db.get_fundamentals('AAPL')
        signal = agent.analyze('AAPL', data)
        
        print(f"{signal.direction.upper()}: {signal.reasoning}")
        await db.disconnect()
    
    asyncio.run(main())
